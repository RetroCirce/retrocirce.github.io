{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/App.vue?f909","webpack:///src/App.vue","webpack:///./src/App.vue?3359","webpack:///./src/App.vue","webpack:///./src/plugins/vuetify.js","webpack:///./src/components/MicTest.vue?56a6","webpack:///./src/plugins/encoder-wav-worker.js","webpack:///./src/plugins/encoder-mp3-worker.js","webpack:///./src/plugins/encoder-ogg-worker.js","webpack:///./src/plugins/RecorderService.js","webpack:///src/components/MicTest.vue","webpack:///./src/components/MicTest.vue?d50a","webpack:///./src/components/MicTest.vue","webpack:///./src/components/PitchDetect.vue?1105","webpack:///./src/plugins/pitch_detect.js","webpack:///src/components/PitchDetect.vue","webpack:///./src/components/PitchDetect.vue?3f8d","webpack:///./src/components/PitchDetect.vue","webpack:///./src/components/Tutorial.vue?4af5","webpack:///src/components/Tutorial.vue","webpack:///./src/components/Tutorial.vue?8a18","webpack:///./src/components/Tutorial.vue","webpack:///./src/main.js","webpack:///./src/assets/logo.svg"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","_vm","this","_h","$createElement","_c","_self","attrs","_v","on","switchToHome","staticClass","staticRenderFns","components","methods","$router","currentRoute","fullPath","component","VApp","VAppBar","VBtn","VCol","VFooter","VIcon","VMain","VSpacer","VToolbarTitle","VToolbar","Vue","use","Vuetify","recordAction","recordings","_l","recording","idx","ts","staticStyle","_s","blobUrl","mimeType","size","_e","BYTES_PER_SAMPLE","recorded","encode","buffer","Uint8Array","index","sample","dump","sampleRate","bufferLength","wav","view","DataView","setUint32","setUint16","set","msg","postMessage","self","onmessage","e","close","channels","kbps","mp3encoder","maxSamples","mp3Data","init","opts","importScripts","baseUrl","lamejs","Mp3Encoder","floatTo16BitPCM","input","output","Math","max","min","convertBuffer","arrayBuffer","Float32Array","out","Int16Array","samplesMono","remaining","left","subarray","encodeBuffer","mp3buf","flush","quality","oggEncoder","oggData","OggVorbisEncoder","blob","finish","BASE_URL","RecorderService","AudioContext","webkitAudioContext","em","document","createDocumentFragment","state","chunks","chunkType","encoderMimeType","config","broadcastAudioProcessEvents","createAnalyserNode","createDynamicsCompressorNode","forceScriptProcessor","manualEncoderId","micGain","processorBufferSize","stopTracksAndCloseCtxWhenFinished","usingMediaRecorder","MediaRecorder","enableEchoCancellation","fn","js","toString","replace","Blob","Worker","URL","createObjectURL","timeslice","navigator","mediaDevices","getUserMedia","audioCtx","micGainNode","createGain","outputGainNode","dynamicsCompressorNode","createDynamicsCompressor","analyserNode","createAnalyser","processorNode","createScriptProcessor","createMediaStreamDestination","destinationNode","destination","encoderWorker","createWorker","EncoderMp3","EncoderOgg","EncoderWav","addEventListener","event","Event","type","_onDataAvailable","userMediaConstraints","audio","echoCancellation","noiseSuppression","autoGainControl","deviceId","then","stream","_startRecordingWithStream","catch","error","alert","message","console","log","newGain","gain","setValueAtTime","currentTime","micAudioStream","inputStreamNode","createMediaStreamSource","context","onGraphSetupWithInputStream","connect","nextNode","onaudioprocess","_onAudioProcess","mediaRecorder","evt","_onError","start","slicing","setInterval","dispatchEvent","CustomEvent","detail","inputBuffer","outputBuffer","getChannelData","stop","clearInterval","Date","getTime","disconnect","getTracks","forEach","track","stopRecording","startRecording","recorder","cleanup","dynamicCompress","echoCancel","isRecording","onNewRecording","created","VCard","VCardTitle","VContainer","VDivider","VLayout","VRow","pitch_name","degree","cents","db","toFixed","sampleLen","model","callback","$$v","expression","PD","buf","fs","seq","MAX_SIZE","floor","threshold","max_freq","min_freq","bufsize","MAX_S","rms","cors","Array","autocorTh","minthres","maxthres","ans_diff","ans_freq","decay","fac","lb","pow","rb","maxbuf","abs","sqrt","cor","diff_temp","freq","a_thres","ceil","diff","best_offset","best_cor","isGoodCor","corTemp","pitch_index","pitch","round","stand_freq","note","draw","analyser","getByteFrequencyData","freqs","getByteTimeDomainData","times","t_value","f_value","drawContext","clearRect","cWidth","cHeight","fillStyle","hue","fillRect","canvas","pitch_canvas","getContext","pitch_canvasWidth","pitch_canvasHeight","pitchSeq","pitchColor","ans_fre","isCalc","ans_pitch","requestAnimationFrame","curPos","VCardText","VFlex","VSlider","testMic","startPitchDetect","VImg","productionTip","VueRouter","showHome","router","routes","path","Tutorial","MicTest","PitchDetect","vuetify","render","h","App","$mount"],"mappings":"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","file":"js/app.0aa59156.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-app',[_c('v-app-bar',{attrs:{\"color\":\"primary\",\"dark\":\"\",\"dense\":\"\",\"app\":\"\"}},[_c('v-toolbar-title',[_vm._v(\"音高识别-Pitch Detection\")]),_c('v-spacer'),_c('v-btn',{attrs:{\"icon\":\"\"},on:{\"click\":_vm.switchToHome}},[_c('v-icon',[_vm._v(\"mdi-home\")])],1)],1),_c('v-main',[_c('router-view')],1),_c('v-footer',{attrs:{\"absolute\":\"\",\"dense\":\"\",\"app\":\"\"}},[_c('v-col',{staticClass:\"text-center\",attrs:{\"cols\":\"12\"}},[_vm._v(\" RetroCirce@2020 \")])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <v-app>\n    <v-app-bar color=\"primary\" dark dense app>\n      <v-toolbar-title>音高识别-Pitch Detection</v-toolbar-title>\n      <v-spacer></v-spacer>\n      <v-btn icon @click=\"switchToHome\">\n           <v-icon>mdi-home</v-icon>\n      </v-btn>\n    </v-app-bar>\n    <v-main>\n      <router-view></router-view>\n    </v-main>\n    <v-footer absolute dense app>\n      <v-col class=\"text-center\" cols=\"12\">\n        RetroCirce@2020\n      </v-col>\n    </v-footer>\n  </v-app>\n</template>\n\n<script>\n\nexport default {\n  name: 'App',\n\n  components: {\n  },\n\n  data: () => ({\n    //\n  }),\n  methods:{\n    switchToHome() {\n      if (this.$router.currentRoute.fullPath != \"/\") this.$router.push(\"/\")\n    }\n  }\n};\n</script>\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=23479d1e&\"\nimport script from \"./App.vue?vue&type=script&lang=js&\"\nexport * from \"./App.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VApp } from 'vuetify/lib/components/VApp';\nimport { VAppBar } from 'vuetify/lib/components/VAppBar';\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VFooter } from 'vuetify/lib/components/VFooter';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VMain } from 'vuetify/lib/components/VMain';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\nimport { VToolbarTitle } from 'vuetify/lib/components/VToolbar';\ninstallComponents(component, {VApp,VAppBar,VBtn,VCol,VFooter,VIcon,VMain,VSpacer,VToolbarTitle})\n","import Vue from 'vue';\nimport Vuetify from 'vuetify/lib';\n\nVue.use(Vuetify);\n\nexport default new Vuetify({\n});\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-container',[_c('v-row',{staticClass:\"text-center\"},[_c('v-col',[_c('h2',[_vm._v(\"麦克风测试\")]),_c('br'),_c('p',[_vm._v(\"请单击录制按钮\")])])],1),_c('v-row',{staticClass:\"text-center\",attrs:{\"justify\":\"center\"}},[_c('v-btn',{attrs:{\"small\":\"\",\"color\":\"primary\"},on:{\"click\":_vm.recordAction}},[(_vm.isRecording)?_c('span',[_vm._v(\"结束录制\")]):_c('span',[_vm._v(\"开始录制\")])])],1),(_vm.recordings.length > 0)?_c('v-layout',{attrs:{\"column\":\"\",\"wrap\":\"\"}},[_c('h4',{staticClass:\"mt-3\"},[_vm._v(\"已保存录音\")]),_vm._l((_vm.recordings),function(recording,idx){return _c('div',{key:recording.ts},[_c('v-card',[_c('v-card-title',{attrs:{\"primary-title\":\"\"}},[_c('v-layout',{attrs:{\"column\":\"\",\"wrap\":\"\"}},[_c('div',{staticStyle:{\"fontSize\":\"0.8em\"}},[_vm._v(\" 录音-\"+_vm._s(idx + 1)+\" \")]),_c('div',{staticClass:\"ml-3\"},[_c('div',[_c('audio',{attrs:{\"src\":recording.blobUrl,\"type\":recording.mimeType,\"controls\":\"true\"}})]),_c('div',{staticStyle:{\"fontSize\":\"0.5em\"}},[_vm._v(\" 大小: \"+_vm._s(recording.size)+\", 类型: \"+_vm._s(recording.mimeType)+\" \")])])])],1)],1),(idx !== (_vm.recordings.length-1))?_c('v-divider'):_vm._e()],1)})],2):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","export default function () {\n// Parts copied from https://github.com/chris-rudmin/Recorderjs\n  let BYTES_PER_SAMPLE = 2\n  let recorded = []\n\n  function encode (buffer) {\n    let length = buffer.length\n    let data = new Uint8Array(length * BYTES_PER_SAMPLE)\n    for (let i = 0; i < length; i++) {\n      let index = i * BYTES_PER_SAMPLE\n      let sample = buffer[i]\n      if (sample > 1) {\n        sample = 1\n      }\n      else if (sample < -1) {\n        sample = -1\n      }\n      sample = sample * 32768\n      data[index] = sample\n      data[index + 1] = sample >> 8\n    }\n    recorded.push(data)\n  }\n\n  function dump (sampleRate) {\n    let bufferLength = recorded.length ? recorded[0].length : 0\n    let length = recorded.length * bufferLength\n    let wav = new Uint8Array(44 + length)\n\n    let view = new DataView(wav.buffer)\n\n    // RIFF identifier 'RIFF'\n    view.setUint32(0, 1380533830, false)\n    // file length minus RIFF identifier length and file description length\n    view.setUint32(4, 36 + length, true)\n    // RIFF type 'WAVE'\n    view.setUint32(8, 1463899717, false)\n    // format chunk identifier 'fmt '\n    view.setUint32(12, 1718449184, false)\n    // format chunk length\n    view.setUint32(16, 16, true)\n    // sample format (raw)\n    view.setUint16(20, 1, true)\n    // channel count\n    view.setUint16(22, 1, true)\n    // sample rate\n    view.setUint32(24, sampleRate, true)\n    // byte rate (sample rate * block align)\n    view.setUint32(28, sampleRate * BYTES_PER_SAMPLE, true)\n    // block align (channel count * bytes per sample)\n    view.setUint16(32, BYTES_PER_SAMPLE, true)\n    // bits per sample\n    view.setUint16(34, 8 * BYTES_PER_SAMPLE, true)\n    // data chunk identifier 'data'\n    view.setUint32(36, 1684108385, false)\n    // data chunk length\n    view.setUint32(40, length, true)\n\n    for (var i = 0; i < recorded.length; i++) {\n      wav.set(recorded[i], i * bufferLength + 44)\n    }\n\n    recorded = []\n    let msg = [wav.buffer]\n    postMessage(msg, [msg[0]])\n  }\n\n  self.onmessage = function (e) {\n    if (e.data[0] === 'encode') {\n      encode(e.data[1])\n    }\n    else if (e.data[0] === 'dump') {\n      dump(e.data[1])\n    }\n    else if (e.data[0] === 'close') {\n      self.close()\n    }\n  }\n}\n","// import 'babel-polyfill'\n// import lamejs from 'lamejs'\n\nexport default function () {\n  // Note that relative paths don't work when loaded as a blob\n  // https://stackoverflow.com/questions/22172426/using-importsscripts-within-blob-in-a-karma-environment\n  // importScripts('https://localhost:8443/workers/encoders/lame.js') // eslint-disable-line\n\n  let channels = 1 // 1 for mono or 2 for stereo\n  // let sampleRate = 44100 // 44.1khz (normal mp3 samplerate)\n  let kbps = 128 // encode 128kbps mp3\n\n  let mp3encoder = null\n\n  const maxSamples = 1152\n\n  var mp3Data = [] // array of Uint8Array\n\n  function init (opts) {\n    /* global lamejs */\n    importScripts(opts.baseUrl + '/workers/encoders/lame.min.js'); // eslint-disable-line\n    mp3encoder = new lamejs.Mp3Encoder(channels, opts.sampleRate, kbps)\n  }\n\n  function floatTo16BitPCM (input, output) {\n    for (var i = 0; i < input.length; i++) {\n      var s = Math.max(-1, Math.min(1, input[i]))\n      output[i] = (s < 0 ? s * 0x8000 : s * 0x7FFF)\n    }\n  }\n\n  function convertBuffer (arrayBuffer) {\n    var data = new Float32Array(arrayBuffer)\n    var out = new Int16Array(arrayBuffer.length)\n    floatTo16BitPCM(data, out)\n    return out\n  }\n\n  function encode (arrayBuffer) {\n    let samplesMono = convertBuffer(arrayBuffer)\n    let remaining = samplesMono.length\n    for (let i = 0; remaining >= 0; i += maxSamples) {\n      var left = samplesMono.subarray(i, i + maxSamples)\n      var data = mp3encoder.encodeBuffer(left)\n      mp3Data.push(data)\n      remaining -= maxSamples\n    }\n\n    // var mp3buf = mp3encoder.encodeBuffer(buffer)\n    // if (mp3buf.length > 0) {\n    //   mp3Data.push(mp3buf)\n    // }\n  }\n\n  function dump () {\n    var mp3buf = mp3encoder.flush()\n    if (mp3buf.length > 0) {\n      mp3Data.push(mp3buf)\n    }\n\n    // Probably results in native memory copy\n    postMessage(mp3Data)\n\n    // Would like to do this, but not possible because mp3Data is generic array of Uint8Array, and generic\n    // arrays are not transferrable types.\n    // postMessage(mp3Data, [mp3Data])\n\n    // This might help if/when ever become available again\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer/transfer\n\n    // For now, though, we have not other option except to build a complete copy in javascript. This means\n    // we temporarily require twice the memory of whatever was recorded.\n\n    mp3Data = []\n  }\n\n  onmessage = function (e) {\n    if (e.data[0] === 'encode') {\n      encode(e.data[1])\n    }\n    else if (e.data[0] === 'dump') {\n      dump(e.data[1])\n    }\n    else if (e.data[0] === 'init') {\n      init(e.data[1])\n    }\n    else if (e.data[0] === 'close') {\n      self.close()\n    }\n  }\n}\n","export default function () {\n  let channels = 1\n  let quality = 0.4\n\n  let oggEncoder = null\n\n  let oggData = []\n\n  function init (opts) {\n    /* global OggVorbisEncoder */\n\n    // Possibly required for loading min version, but couldn't get min version to work. Not sure why.\n    // self.OggVorbisEncoderConfig = {\n    //   memoryInitializerPrefixURL: opts.baseUrl + '/workers/encoders/'\n    // }\n\n    // Unable to load min version. Not sure why.  Error in firefox is \"The URI is malformed\". Guessing related to the .mem.\n    importScripts(opts.baseUrl + '/workers/encoders/OggVorbisEncoder.js'); // eslint-disable-line\n    oggEncoder = new OggVorbisEncoder(opts.sampleRate, channels, quality)\n  }\n\n  function encode (arrayBuffer) {\n    var data = oggEncoder.encode([arrayBuffer])\n    oggData.push(data)\n  }\n\n  function dump () {\n    let blob = oggEncoder.finish('audio/ogg')\n\n    // this works, but likely results in native memory copy\n    postMessage(blob)\n\n    // Looking at source of OggVorbisEncoder, I think it would be easy to change to allow transferring of the\n    // raw buffer instead.\n\n    // this does not work, I presume because blobs aren't transferrable\n    // postMessage(blob, [blob])\n\n    oggData = []\n  }\n\n  onmessage = function (e) {\n    if (e.data[0] === 'encode') {\n      encode(e.data[1])\n    }\n    else if (e.data[0] === 'dump') {\n      dump(e.data[1])\n    }\n    else if (e.data[0] === 'init') {\n      init(e.data[1])\n    }\n    else if (e.data[0] === 'close') {\n      self.close()\n    }\n  }\n}\n","/* Copyright (c) 2019 Josh Sanderson */\r\n\r\nimport EncoderWav from './encoder-wav-worker.js'\r\nimport EncoderMp3 from './encoder-mp3-worker.js'\r\nimport EncoderOgg from './encoder-ogg-worker.js'\r\n\r\n// const BASE_URL = \"https://localhost:8080\"\r\nconst BASE_URL = \"https://retrocirce.github.io/dist\"\r\n\r\nexport default class RecorderService {\r\n  constructor (baseUrl) {\r\n    this.baseUrl = baseUrl\r\n\r\n    window.AudioContext = window.AudioContext || window.webkitAudioContext\r\n\r\n    this.em = document.createDocumentFragment()\r\n\r\n    this.state = 'inactive'\r\n\r\n    this.chunks = []\r\n    this.chunkType = ''\r\n\r\n    this.encoderMimeType = 'audio/wav'\r\n\r\n    this.config = {\r\n      broadcastAudioProcessEvents: false,\r\n      createAnalyserNode: false,\r\n      createDynamicsCompressorNode: false,\r\n      forceScriptProcessor: false,\r\n      manualEncoderId: 'wav',\r\n      micGain: 1.0,\r\n      processorBufferSize: 2048,\r\n      stopTracksAndCloseCtxWhenFinished: true,\r\n      usingMediaRecorder: typeof window.MediaRecorder !== 'undefined',\r\n      enableEchoCancellation: false\r\n    }\r\n  }\r\n\r\n  createWorker (fn) {\r\n    var js = fn\r\n      .toString()\r\n      .replace(/^function\\s*\\(\\)\\s*{/, '')\r\n      .replace(/}$/, '')\r\n    var blob = new Blob([js])\r\n    return new Worker(URL.createObjectURL(blob))\r\n  }\r\n\r\n  startRecording (timeslice) {\r\n    if (this.state !== 'inactive') {\r\n      return\r\n    }\r\n\r\n    // This is the case on ios/chrome, when clicking links from within ios/slack (sometimes), etc.\r\n    if (!navigator || !navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\r\n      alert('Missing support for navigator.mediaDevices.getUserMedia') // temp: helps when testing for strange issues on ios/safari\r\n      return\r\n    }\r\n\r\n    this.audioCtx = new AudioContext()\r\n    this.micGainNode = this.audioCtx.createGain()\r\n    this.outputGainNode = this.audioCtx.createGain()\r\n\r\n    if (this.config.createDynamicsCompressorNode) {\r\n      this.dynamicsCompressorNode = this.audioCtx.createDynamicsCompressor()\r\n    }\r\n\r\n    if (this.config.createAnalyserNode) {\r\n      this.analyserNode = this.audioCtx.createAnalyser()\r\n    }\r\n\r\n    // If not using MediaRecorder(i.e. safari and edge), then a script processor is required. It's optional\r\n    // on browsers using MediaRecorder and is only useful if wanting to do custom analysis or manipulation of\r\n    // recorded audio data.\r\n    if (this.config.forceScriptProcessor || this.config.broadcastAudioProcessEvents || !this.config.usingMediaRecorder) {\r\n      this.processorNode = this.audioCtx.createScriptProcessor(this.config.processorBufferSize, 1, 1) // TODO: Get the number of channels from mic\r\n    }\r\n\r\n    // Create stream destination on chrome/firefox because, AFAICT, we have no other way of feeding audio graph output\r\n    // in to MediaRecorderSafari/Edge don't have this method as of 2018-04.\r\n    if (this.audioCtx.createMediaStreamDestination) {\r\n      this.destinationNode = this.audioCtx.createMediaStreamDestination()\r\n    }\r\n    else {\r\n      this.destinationNode = this.audioCtx.destination\r\n    }\r\n\r\n    // Create web worker for doing the encoding\r\n    if (!this.config.usingMediaRecorder) {\r\n      if (this.config.manualEncoderId === 'mp3') {\r\n        // This also works and avoids weirdness imports with workers\r\n        // this.encoderWorker = new Worker(BASE_URL + '/workers/encoder-ogg-worker.js')\r\n        this.encoderWorker = this.createWorker(EncoderMp3)\r\n        this.encoderWorker.postMessage(['init', { baseUrl: BASE_URL, sampleRate: this.audioCtx.sampleRate }])\r\n        this.encoderMimeType = 'audio/mpeg'\r\n      }\r\n      else if (this.config.manualEncoderId === 'ogg') {\r\n        this.encoderWorker = this.createWorker(EncoderOgg)\r\n        this.encoderWorker.postMessage(['init', { baseUrl: BASE_URL, sampleRate: this.audioCtx.sampleRate }])\r\n        this.encoderMimeType = 'audio/ogg'\r\n      }\r\n      else {\r\n        this.encoderWorker = this.createWorker(EncoderWav)\r\n        this.encoderMimeType = 'audio/wav'\r\n      }\r\n      this.encoderWorker.addEventListener('message', (e) => {\r\n        let event = new Event('dataavailable')\r\n        if (this.config.manualEncoderId === 'ogg') {\r\n          event.data = e.data\r\n        }\r\n        else {\r\n          event.data = new Blob(e.data, { type: this.encoderMimeType })\r\n        }\r\n        this._onDataAvailable(event)\r\n      })\r\n    }\r\n\r\n    // Setup media constraints\r\n    const userMediaConstraints = {\r\n      audio: {\r\n        echoCancellation: this.config.enableEchoCancellation,\r\n        noiseSuppression: false,\r\n        autoGainControl: false\r\n      }\r\n    }\r\n    if (this.config.deviceId) {\r\n      userMediaConstraints.audio.deviceId = this.config.deviceId\r\n    }\r\n\r\n    // This will prompt user for permission if needed\r\n    return navigator.mediaDevices.getUserMedia(userMediaConstraints)\r\n      .then((stream) => {\r\n        this._startRecordingWithStream(stream, timeslice)\r\n      })\r\n      .catch((error) => {\r\n        alert('Error with getUserMedia: ' + error.message) // temp: helps when testing for strange issues on ios/safari\r\n        console.log(error)\r\n      })\r\n  }\r\n\r\n  setMicGain (newGain) {\r\n    this.config.micGain = newGain\r\n    if (this.audioCtx && this.micGainNode) {\r\n      this.micGainNode.gain.setValueAtTime(newGain, this.audioCtx.currentTime)\r\n    }\r\n  }\r\n\r\n  _startRecordingWithStream (stream, timeslice) {\r\n    this.micAudioStream = stream\r\n\r\n    this.inputStreamNode = this.audioCtx.createMediaStreamSource(this.micAudioStream)\r\n    this.audioCtx = this.inputStreamNode.context\r\n\r\n    // Kind-of a hack to allow hooking in to audioGraph inputStreamNode\r\n    if (this.onGraphSetupWithInputStream) {\r\n      this.onGraphSetupWithInputStream(this.inputStreamNode)\r\n    }\r\n\r\n    this.inputStreamNode.connect(this.micGainNode)\r\n    this.micGainNode.gain.setValueAtTime(this.config.micGain, this.audioCtx.currentTime)\r\n\r\n    let nextNode = this.micGainNode\r\n    if (this.dynamicsCompressorNode) {\r\n      this.micGainNode.connect(this.dynamicsCompressorNode)\r\n      nextNode = this.dynamicsCompressorNode\r\n    }\r\n\r\n    this.state = 'recording'\r\n\r\n    if (this.processorNode) {\r\n      nextNode.connect(this.processorNode)\r\n      this.processorNode.connect(this.outputGainNode)\r\n      this.processorNode.onaudioprocess = (e) => this._onAudioProcess(e)\r\n    }\r\n    else {\r\n      nextNode.connect(this.outputGainNode)\r\n    }\r\n\r\n    if (this.analyserNode) {\r\n      // TODO: If we want the analyser node to receive the processorNode's output, this needs to be changed _and_\r\n      //       processor node needs to be modified to copy input to output. It currently doesn't because it's not\r\n      //       needed when doing manual encoding.\r\n      // this.processorNode.connect(this.analyserNode)\r\n      nextNode.connect(this.analyserNode)\r\n    }\r\n\r\n    this.outputGainNode.connect(this.destinationNode)\r\n\r\n    if (this.config.usingMediaRecorder) {\r\n      this.mediaRecorder = new MediaRecorder(this.destinationNode.stream)\r\n      this.mediaRecorder.addEventListener('dataavailable', (evt) => this._onDataAvailable(evt))\r\n      this.mediaRecorder.addEventListener('error', (evt) => this._onError(evt))\r\n\r\n      this.mediaRecorder.start(timeslice)\r\n    }\r\n    else {\r\n      // Output gain to zero to prevent feedback. Seems to matter only on Edge, though seems like should matter\r\n      // on iOS too.  Matters on chrome when connecting graph to directly to audioCtx.destination, but we are\r\n      // not able to do that when using MediaRecorder.\r\n      this.outputGainNode.gain.setValueAtTime(0, this.audioCtx.currentTime)\r\n      // this.outputGainNode.gain.value = 0\r\n\r\n      // Todo: Note that time slicing with manual wav encoderWav won't work. To allow it would require rewriting the encoderWav\r\n      // to assemble all chunks at end instead of adding header to each chunk.\r\n      if (timeslice) {\r\n        console.log('Time slicing without MediaRecorder is not yet supported. The resulting recording will not be playable.')\r\n        this.slicing = setInterval(function () {\r\n          if (this.state === 'recording') {\r\n            this.encoderWorker.postMessage(['dump', this.context.sampleRate])\r\n          }\r\n        }, timeslice)\r\n      }\r\n    }\r\n  }\r\n\r\n  _onAudioProcess (e) {\r\n    // console.log('onaudioprocess', e)\r\n    // let inputBuffer = e.inputBuffer\r\n    // let outputBuffer = e.outputBuffer\r\n    // console.log(this.micAudioStream)\r\n    // console.log(this.audioCtx)\r\n    // console.log(this.micAudioStream.getTracks().forEach((track) => console.log(track)))\r\n\r\n    // this.onAudioEm.dispatch(new Event('onaudioprocess', {inputBuffer:inputBuffer,outputBuffer:outputBuffer}))\r\n\r\n    if (this.config.broadcastAudioProcessEvents) {\r\n      this.em.dispatchEvent(new CustomEvent('onaudioprocess', {\r\n        detail: {\r\n          inputBuffer: e.inputBuffer,\r\n          outputBuffer: e.outputBuffer\r\n        }\r\n      }))\r\n    }\r\n\r\n    // // Example handling:\r\n    // let inputBuffer = e.inputBuffer\r\n    // let outputBuffer = e.outputBuffer\r\n    // // Each channel (usually only one)\r\n    // for (let channel = 0; channel < outputBuffer.numberOfChannels; channel++) {\r\n    //   let inputData = inputBuffer.getChannelData(channel)\r\n    //   let outputData = outputBuffer.getChannelData(channel)\r\n    //\r\n    //   // Each sample\r\n    //   for (let sample = 0; sample < inputBuffer.length; sample++) {\r\n    //     // Make output equal to the same as the input (thus processor is doing nothing at this time)\r\n    //     outputData[sample] = inputData[sample]\r\n    //   }\r\n    // }\r\n\r\n    // When manually encoding (safari/edge), there's no reason to copy data to output buffer.  We set the output\r\n    // gain to 0 anyways (which is required on Edge if we did copy data to output). However, if using a MediaRecorder\r\n    // and a processor (all other browsers), then it would be required to copy the data otherwise the graph would\r\n    // generate no data for the MediaRecorder to consume.\r\n    // if (this.forceScriptProcessor) {\r\n\r\n    // // Copy input to output\r\n    // let inputBuffer = e.inputBuffer\r\n    // let outputBuffer = e.outputBuffer\r\n    // // This doesn't work on iOS/Safari. Guessing it doesn't have copyToChannel support, but haven't verified.\r\n    // for (let channel = 0; channel < outputBuffer.numberOfChannels; channel++) {\r\n    //   outputBuffer.copyToChannel(inputBuffer.getChannelData(channel), channel)\r\n    // }\r\n\r\n    // Safari and Edge require manual encoding via web worker. Single channel only for now.\r\n    // Example stereo encoderWav: https://github.com/MicrosoftEdge/Demos/blob/master/microphone/scripts/recorderworker.js\r\n    if (!this.config.usingMediaRecorder) {\r\n      if (this.state === 'recording') {\r\n        if (this.config.broadcastAudioProcessEvents) {\r\n          this.encoderWorker.postMessage(['encode', e.outputBuffer.getChannelData(0)])\r\n        }\r\n        else {\r\n          this.encoderWorker.postMessage(['encode', e.inputBuffer.getChannelData(0)])\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  stopRecording () {\r\n    if (this.state === 'inactive') {\r\n      return\r\n    }\r\n    if (this.config.usingMediaRecorder) {\r\n      this.state = 'inactive'\r\n      this.mediaRecorder.stop()\r\n    }\r\n    else {\r\n      this.state = 'inactive'\r\n      this.encoderWorker.postMessage(['dump', this.audioCtx.sampleRate])\r\n      clearInterval(this.slicing)\r\n\r\n      // TODO: There should be a more robust way to handle this\r\n      // Without something like this, I think  the last recorded sample could be lost due to timing\r\n      // setTimeout(() => {\r\n      //   this.state = 'inactive'\r\n      //   this.encoderWorker.postMessage(['dump', this.audioCtx.sampleRate])\r\n      // }, 100)\r\n    }\r\n  }\r\n\r\n  _onDataAvailable (evt) {\r\n    // console.log('state', this.mediaRecorder.state)\r\n    // console.log('evt.data', evt.data)\r\n\r\n    this.chunks.push(evt.data)\r\n    this.chunkType = evt.data.type\r\n\r\n    if (this.state !== 'inactive') {\r\n      return\r\n    }\r\n\r\n    let blob = new Blob(this.chunks, { 'type': this.chunkType })\r\n    let blobUrl = URL.createObjectURL(blob)\r\n    const recording = {\r\n      ts: new Date().getTime(),\r\n      blobUrl: blobUrl,\r\n      mimeType: blob.type,\r\n      size: blob.size\r\n    }\r\n\r\n    this.chunks = []\r\n    this.chunkType = null\r\n\r\n    if (this.destinationNode) {\r\n      this.destinationNode.disconnect()\r\n      this.destinationNode = null\r\n    }\r\n    if (this.outputGainNode) {\r\n      this.outputGainNode.disconnect()\r\n      this.outputGainNode = null\r\n    }\r\n    if (this.analyserNode) {\r\n      this.analyserNode.disconnect()\r\n      this.analyserNode = null\r\n    }\r\n    if (this.processorNode) {\r\n      this.processorNode.disconnect()\r\n      this.processorNode = null\r\n    }\r\n    if (this.encoderWorker) {\r\n      this.encoderWorker.postMessage(['close'])\r\n      this.encoderWorker = null\r\n    }\r\n    if (this.dynamicsCompressorNode) {\r\n      this.dynamicsCompressorNode.disconnect()\r\n      this.dynamicsCompressorNode = null\r\n    }\r\n    if (this.micGainNode) {\r\n      this.micGainNode.disconnect()\r\n      this.micGainNode = null\r\n    }\r\n    if (this.inputStreamNode) {\r\n      this.inputStreamNode.disconnect()\r\n      this.inputStreamNode = null\r\n    }\r\n\r\n    if (this.config.stopTracksAndCloseCtxWhenFinished) {\r\n      // This removes the red bar in iOS/Safari\r\n      this.micAudioStream.getTracks().forEach((track) => track.stop())\r\n      this.micAudioStream = null\r\n\r\n      this.audioCtx.close()\r\n      this.audioCtx = null\r\n    }\r\n\r\n    this.em.dispatchEvent(new CustomEvent('recording', { detail: { recording: recording } }))\r\n  }\r\n\r\n  _onError (evt) {\r\n    console.log('error', evt)\r\n    this.em.dispatchEvent(new Event('error'))\r\n    alert('error:' + evt) // for debugging purposes\r\n  }\r\n}\r\n","<template>\r\n  <v-container>\r\n    <v-row class=\"text-center\">\r\n      <v-col>\r\n       <h2>麦克风测试</h2><br>\r\n       <p>请单击录制按钮</p>\r\n      </v-col>\r\n    </v-row>\r\n    <v-row class=\"text-center\" justify=\"center\">\r\n        <v-btn small color = \"primary\" @click=\"recordAction\"> \r\n          <span v-if=\"isRecording\">结束录制</span>\r\n          <span v-else>开始录制</span>\r\n        </v-btn>\r\n    </v-row>\r\n    <v-layout column wrap v-if=\"recordings.length > 0\">\r\n      <h4 class=\"mt-3\">已保存录音</h4>\r\n      <div v-for=\"(recording,idx) in recordings\" :key=\"recording.ts\">\r\n        <v-card>\r\n          <v-card-title primary-title>\r\n            <v-layout column wrap>\r\n              <div style=\"fontSize:0.8em\">\r\n                录音-{{ idx + 1 }}\r\n              </div>\r\n              <div class=\"ml-3\">\r\n                <div>\r\n                  <audio :src=\"recording.blobUrl\" :type=\"recording.mimeType\" controls=\"true\"/>\r\n                </div>\r\n                <div  style=\"fontSize:0.5em\">\r\n                   大小: {{recording.size}}, 类型: {{recording.mimeType}}\r\n                </div>\r\n              </div>\r\n            </v-layout>\r\n          </v-card-title>\r\n        </v-card>\r\n        <v-divider v-if=\"idx !== (recordings.length-1)\"/>\r\n      </div>\r\n    </v-layout>\r\n  </v-container>\r\n</template>\r\n\r\n\r\n<script>\r\n\r\nimport RecorderService from '../plugins/RecorderService'\r\n// import utils from '../plugins/Utils'\r\n\r\nexport default {\r\n  name: 'MicTest',\r\n  data: () => ({\r\n    echoCancel: false,\r\n    isRecording: false,\r\n    mimeTypes: [],\r\n    recordings: [],\r\n    micGain: 1.0,\r\n    cleanup: true,\r\n    dynamicCompress: false\r\n  }),\r\n  methods: {\r\n    recordAction() {\r\n      if(this.isRecording) {\r\n        this.stopRecording()\r\n      }\r\n      else {\r\n        this.startRecording()\r\n      }\r\n    },\r\n    startRecording () {\r\n      this.recorder.config.stopTracksAndCloseCtxWhenFinished = this.cleanup\r\n      this.recorder.config.createDynamicsCompressorNode = this.dynamicCompress\r\n      this.recorder.config.enableEchoCancellation = this.echoCancel\r\n      this.recorder.startRecording()\r\n        .then(() => {\r\n          this.isRecording = true\r\n        })\r\n        .catch((error) => {\r\n          console.error('Recording Failed: ' + error)\r\n          alert('Recording Failed: ' + error.message)\r\n        })\r\n    },\r\n    stopRecording () {\r\n      this.recorder.stopRecording()\r\n      this.isRecording = false\r\n    },\r\n    onNewRecording (evt) {\r\n      this.recordings.push(evt.detail.recording)\r\n    }\r\n  },\r\n  created() {\r\n    this.recorder = new RecorderService()\r\n    this.recorder.em.addEventListener(\"recording\", (evt) => this.onNewRecording(evt))\r\n  }\r\n}\r\n</script>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MicTest.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MicTest.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./MicTest.vue?vue&type=template&id=e9bd20fc&\"\nimport script from \"./MicTest.vue?vue&type=script&lang=js&\"\nexport * from \"./MicTest.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VCardTitle } from 'vuetify/lib/components/VCard';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VDivider } from 'vuetify/lib/components/VDivider';\nimport { VLayout } from 'vuetify/lib/components/VGrid';\nimport { VRow } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VCard,VCardTitle,VCol,VContainer,VDivider,VLayout,VRow})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-container',[_c('v-row',{staticClass:\"text-center\",attrs:{\"justify\":\"center\"}},[_c('v-col',{attrs:{\"cols\":\"6\"}},[_c('h2',[_vm._v(\"音高识别\")]),_c('v-btn',{staticClass:\"mt-2\",attrs:{\"small\":\"\",\"color\":\"primary\"},on:{\"click\":_vm.recordAction}},[(_vm.isRecording)?_c('span',[_vm._v(\"结束录制\")]):_c('span',[_vm._v(\"开始录制\")])])],1),_c('v-col',{attrs:{\"cols\":\"6\"}},[_c('v-card',{staticClass:\"mx-auto white--text\",attrs:{\"max-width\":\"6em\",\"max-height\":\"6em\",\"color\":\"primary\"}},[_c('v-card-text',{staticClass:\"white--text\",staticStyle:{\"padding\":\"0\"}},[_c('div',{staticClass:\"display-1 \",attrs:{\"id\":\"pitch_name\"}},[_vm._v(\" \"+_vm._s(_vm.pitch_name)+\" \")]),_c('div',{attrs:{\"id\":\"degree_name\"}},[_vm._v(\" \"+_vm._s(_vm.degree))]),_c('div',{attrs:{\"id\":\"cents_name\"}},[_vm._v(\" \"+_vm._s(_vm.cents)+\" \")])])],1)],1)],1),_c('v-layout',{staticClass:\"mx-2 my-1\",attrs:{\"row\":\"\",\"wrap\":\"\"}},[_c('v-flex',{attrs:{\"xs12\":\"\"}},[_c('h4',{},[_vm._v(\"音量能量:\"+_vm._s(_vm.db.toFixed(3))+\" 采样长度:\"+_vm._s(_vm.sampleLen)+\" \")])]),_c('v-flex',{attrs:{\"xs12\":\"\"}},[_c('h5',{staticClass:\"mt-3\"},[_vm._v(\"如果发现音量能量总是为0或者过大，请调整麦克风音量: \"+_vm._s(_vm.micGain))]),_c('v-slider',{attrs:{\"min\":\"0.0\",\"max\":\"5.0\",\"label\":\"mic音量\",\"step\":\"0.1\"},model:{value:(_vm.micGain),callback:function ($$v) {_vm.micGain=$$v},expression:\"micGain\"}})],1),_c('v-flex',{attrs:{\"xs12\":\"\"}},[_c('h4',{staticClass:\"mt-3\"},[_vm._v(\"实时音频\")]),_c('v-divider')],1),_c('v-flex',{attrs:{\"xs12\":\"\"}},[_c('canvas',{staticStyle:{\"border\":\"1px solid black\",\"width\":\"100%\",\"height\":\"7em\"},attrs:{\"id\":\"audio_canvas\"}})])],1),_c('v-layout',{staticClass:\"mt-1 mx-2\",attrs:{\"row\":\"\",\"wrap\":\"\"}},[_c('v-flex',{attrs:{\"xs12\":\"\"}},[_c('h4',{staticClass:\"mt-3\"},[_vm._v(\"音高曲线\")]),_c('v-divider')],1),_c('v-flex',{attrs:{\"xs12\":\"\"}},[_c('canvas',{staticStyle:{\"border\":\"1px solid black\",\"width\":\"100%\",\"height\":\"28em\"},attrs:{\"id\":\"pitch_canvas\"}})])],1),(_vm.recordings.length > 0)?_c('v-layout',{attrs:{\"column\":\"\",\"wrap\":\"\"}},[_c('h4',{staticClass:\"mt-3\"},[_vm._v(\"已保存录音\")]),_vm._l((_vm.recordings),function(recording,idx){return _c('div',{key:recording.ts},[_c('v-card',[_c('v-card-title',{attrs:{\"primary-title\":\"\"}},[_c('v-layout',{attrs:{\"column\":\"\",\"wrap\":\"\"}},[_c('div',{staticStyle:{\"fontSize\":\"0.8em\"}},[_vm._v(\" 录音-\"+_vm._s(idx + 1)+\" \")]),_c('div',{staticClass:\"ml-3\"},[_c('div',[_c('audio',{attrs:{\"src\":recording.blobUrl,\"type\":recording.mimeType,\"controls\":\"true\"}})]),_c('div',{staticStyle:{\"fontSize\":\"0.5em\"}},[_vm._v(\" 大小: \"+_vm._s(recording.size)+\", 类型: \"+_vm._s(recording.mimeType)+\" \")])])])],1)],1),(idx !== (_vm.recordings.length-1))?_c('v-divider'):_vm._e()],1)})],2):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","// pitch detection via auto-correlation\r\n\r\nexport class PD {\r\n    // var analyser = null;\r\n    // var audioStream = null;\r\n    // var freq_text = null;\r\n    // var audioContext = null;\r\n    // var buflen = 1024;\r\n    // var buf = new Float32Array(buflen);\r\n    // var rafID = null;\r\n    // var max_freq = 2000;\r\n    // var canv = null;\r\n    // var devicePixelRatio = null;\r\n    // var numX = null;\r\n    // var color = null;\r\n    // var line = null;\r\n    // var wglp = null;\r\n    // var wglp_x = null;\r\n\r\n// window.onload = function () {\r\n//     freq_text = document.getElementById(\"show-freq\");\r\n\r\n//     $('#record').click(function (e) {\r\n//         canv = document.getElementById(\"my_canvas\");\r\n//         devicePixelRatio = window.devicePixelRatio || 1;\r\n//         numX = Math.round(canv.clientWidth * devicePixelRatio);\r\n//         color = new _webglPlot.ColorRGBA(Math.random(), Math.random(), Math.random(), 1);\r\n//         line = new _webglPlot.WebglLine(color, numX);\r\n//         wglp = new _webglPlot2.default(canv);\r\n//         wglp_x = 0;\r\n//         line.lineSpaceX(-1, 2 / numX);\r\n//         wglp.addLine(line);\r\n//         beginRecord();\r\n//     });\r\n// };\r\n    new_get_frequency(buf, fs, gain, seq) {\r\n        let MAX_SIZE = Math.max(4, Math.floor(fs / 5000))\r\n        let threshold = 0.01\r\n        // let seqlen = seq.length\r\n        let max_freq = 2000;\r\n        let min_freq = 55;\r\n        let bufsize = buf.length;\r\n        let MAX_S = Math.floor(bufsize / 2);\r\n        let rms = 0;\r\n        let cors = new Array(MAX_S);\r\n        let autocorTh = new Array(max_freq + 1)\r\n        let minthres = 0.75\r\n        let maxthres = 0.95\r\n        let ans_diff = false\r\n        let ans_freq = -1\r\n        // init the threshold\r\n        for (let i = 0;i <= max_freq;++i) autocorTh[i] = 0.85\r\n\r\n        let decay = 0.8\r\n        let fac = 0.01\r\n        \r\n        // get each freq threshold\r\n        if (fac < 0.01) {\r\n            for (let i = 0;i < 300;++i) {\r\n                if(seq[i] > min_freq && seq[i] < max_freq) {\r\n                    let lb = Math.floor(Math.max(min_freq, seq[i] * Math.pow(2, -0.33)))\r\n                    let rb = Math.floor(Math.min(max_freq, seq[i] * Math.pow(2, 0.33)))\r\n                    for (let j = lb;j <= rb;++j) {\r\n                        autocorTh[j] = Math.max(minthres, autocorTh[j] - fac)\r\n                    }\r\n                    lb = Math.floor(Math.min(max_freq, seq[i] * Math.pow(2, 1.5)))\r\n                    rb = Math.floor(Math.max(min_freq, seq[i] * Math.pow(2, -1.5)))\r\n                    for (let j = lb;j <= max_freq;++j) {\r\n                        autocorTh[j] = Math.min(maxthres, autocorTh[j] + fac)\r\n                        // if (autocorTh[j] >= 0.995) console.log([j, autocorTh[j]])\r\n                    }\r\n                    for (let j = min_freq;j <= rb;++j) {\r\n                        autocorTh[j] = Math.min(maxthres, autocorTh[j] + fac)\r\n                        // if (autocorTh[j] >= 0.995) console.log([j, autocorTh[j]])\r\n                    }\r\n                }\r\n                fac = fac * decay\r\n            }\r\n        }\r\n        let maxbuf = -2\r\n        // calc the whole energy of the singal\r\n        for (let i = 0; i < bufsize; ++i) {\r\n            rms += buf[i] * buf[i];\r\n            maxbuf = Math.max(maxbuf, Math.abs(buf[i]))\r\n        }\r\n        rms = Math.sqrt(rms / bufsize) * gain;\r\n        // too low to be regarded as noise\r\n        if (rms < threshold) return [-1,0]\r\n        for (let i = 0;i < bufsize;++i) {\r\n            buf[i] = buf[i] / maxbuf\r\n        }\r\n        // let max_cor = 0\r\n        // let min_cor = 1\r\n        // let max_pos = 0\r\n        // let min_pos = 1\r\n        for (let j = 0; j < MAX_S; ++j) {\r\n            let cor = 0\r\n            if ((fs / j +0.001) > max_freq || fs / (j + 0.001) < min_freq) {\r\n                cor = MAX_S\r\n            }\r\n            else {\r\n                for (let i = 0; i < MAX_S; ++i) {\r\n                    cor += Math.abs(buf[i] - buf[i + j])\r\n                }\r\n            }\r\n            cor = 1 - cor / MAX_S\r\n            cors[j] = cor\r\n            // if (cors[j] < 1) {\r\n            //     if (max_cor < cors[j]) {\r\n            //         max_cor = cors[j]\r\n            //         max_pos = fs / (j + 0.001)\r\n            //     }\r\n            // }\r\n            // if (min_cor > cors[j]) {\r\n            //     min_cor = cors[j]\r\n            //     min_pos = fs / (j + 0.001)\r\n            // }\r\n        }\r\n        let diff_temp = 1\r\n        // console.log([max_cor, min_cor,max_pos,min_pos])\r\n        for (let j = 1;j < MAX_S - 1;++j) {\r\n            let shift = (cors[j + 1] - cors[j - 1]) / cors[j]\r\n            let freq = fs / (j + (MAX_SIZE - 1) * shift)\r\n            if (freq < min_freq || freq > max_freq) continue \r\n            let a_thres = autocorTh[Math.floor(freq)] * (Math.ceil(freq) - freq) + autocorTh[Math.ceil(freq)] * (freq - Math.floor(freq))\r\n            let diff = cors[j] - a_thres\r\n            if (diff > 0 && diff > diff_temp) {\r\n                ans_diff = true\r\n                ans_freq = freq\r\n            }\r\n            else if (ans_diff) {\r\n                return [ans_freq, rms]\r\n            }\r\n            diff_temp = diff\r\n        }\r\n        \r\n        // decide which is a good one\r\n        return [-1, rms]\r\n\r\n    }\r\n\r\n    get_frequency(buf, fs, gain) {\r\n        let MAX_SIZE = Math.max(4, Math.floor(fs / 5000))\r\n        // var khz = 5000;\r\n        let threshold = 0.01\r\n        let autocorTh = 0.85\r\n        // var isRecord = false;\r\n        let max_freq = 2000;\r\n        let min_freq = 55;\r\n        let bufsize = buf.length;\r\n        let MAX_S = Math.floor(bufsize / 2);\r\n        let best_offset = -1;\r\n        let best_cor = 0;\r\n        let rms = 0;\r\n        let isGoodCor = false;\r\n        let cors = new Array(MAX_S);\r\n        // console.log(buf)\r\n        // calc the whole energy of the singal\r\n        let maxbuf = -2\r\n        for (let i = 0; i < bufsize; ++i) {\r\n            rms += buf[i] * buf[i];\r\n            maxbuf = Math.max(maxbuf, Math.abs(buf[i]))\r\n        }\r\n        rms = Math.sqrt(rms / bufsize) * gain;\r\n        // console.log(rms)\r\n        // too low to be regarded as noise\r\n        if (rms < threshold) return [-1,0]\r\n\r\n        for (let i = 0;i < bufsize;++i) {\r\n            buf[i] = buf[i] / maxbuf\r\n        }\r\n        let corTemp = 1\r\n        for (let j = 0; j < MAX_S; ++j) {\r\n            let cor = 0\r\n            if (j == 0 || fs / j > max_freq || fs / j < min_freq) continue\r\n            for (let i = 0; i < MAX_S; ++i) {\r\n                cor += Math.abs(buf[i] - buf[i + j])\r\n            }\r\n            cor = 1 - cor / MAX_S\r\n            cors[j] = cor\r\n            if (cor > autocorTh && cor > corTemp) {\r\n                isGoodCor = true\r\n                if (cor > best_cor) {\r\n                    best_cor = cor\r\n                    best_offset = j\r\n                }\r\n            } else if (isGoodCor) {\r\n                let shift = (cors[best_offset + 1] - cors[best_offset - 1]) / cors[best_offset]\r\n                let freq = fs / (best_offset + (MAX_SIZE - 1) * shift)\r\n                if (freq < 0) freq = 0;\r\n                if (freq > max_freq) freq = max_freq;\r\n                return [freq, rms]\r\n            }\r\n            corTemp = cor;\r\n        }\r\n        return [-1, 0];\r\n    }\r\n\r\n\r\n    get_pitch(freq) {\r\n        let pitch_index = [\"C\", \"C#\", \"D\", \"D#\", \"E\", \"F\", \"F#\", \"G\", \"G#\", \"A\", \"A#\", \"B\"]\r\n        if (freq == -1) return [\"N\",\"0\",\"0\"]\r\n        let pitch = 12 * (Math.log(freq / 440) / Math.log(2));\r\n        pitch = Math.round(pitch) + 69;\r\n        let stand_freq = 440 * Math.pow(2, (pitch - 69) / 12);\r\n        let cents = Math.floor(1200 * Math.log(freq / stand_freq) / Math.log(2));\r\n        let degree = Math.floor(pitch / 12) - 1;\r\n        let note = pitch % 12;\r\n        return [pitch_index[note], degree.toString(), cents]// + \" cents &#9837\";\r\n    }\r\n\r\n\r\n// function getStream(stream) {\r\n//     audioContext = new AudioContext();\r\n//     console.log(audioContext.sampleRate);\r\n//     MAX_SIZE = Math.max(4, Math.floor(audioContext.sampleRate / khz));\r\n//     audioStream = audioContext.createMediaStreamSource(stream);\r\n//     analyser = audioContext.createAnalyser();\r\n//     analyser.fftSize = 2048;\r\n//     audioStream.connect(analyser);\r\n//     update();\r\n// }\r\n\r\n// function error() {\r\n//     alert('Record Failed!');\r\n// }\r\n\r\n// function beginRecord() {\r\n//     if (isRecord) {\r\n//         if (!window.cancelAnimationFrame) window.cancelAnimationFrame = window.webkitCancelAnimationFrame;\r\n//         window.cancelAnimationFrame(rafID);\r\n//         analyser = null;\r\n//         audioStream = null;\r\n//         audioContext = null;\r\n//         isRecord = false;\r\n//         $(\"#record\").innerHTML = \"Click Here to Start Record\";\r\n//     } else {\r\n//         try {\r\n//             isRecord = true;\r\n\r\n//             $(\"#record\").innerHTML = \"Click Here to Stop Record\";\r\n//             navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;\r\n//             navigator.getUserMedia({\r\n//                 \"audio\": {\r\n//                     \"mandatory\": {\r\n//                         \"googEchoCancellation\": \"false\",\r\n//                         \"googAutoGainControl\": \"false\",\r\n//                         \"googNoiseSuppression\": \"false\",\r\n//                         \"googHighpassFilter\": \"false\"\r\n//                     },\r\n//                     \"optional\": []\r\n//                 }\r\n//             }, getStream, error);\r\n//         } catch (e) {\r\n//             alert('get media failed' + e);\r\n//         }\r\n//     }\r\n// }\r\n\r\n// function update() {\r\n//     analyser.getFloatTimeDomainData(buf);\r\n//     freq = get_frequency(buf, audioContext.sampleRate);\r\n//     if (freq < 0) freq = 0;\r\n//     if (freq > max_freq) freq = max_freq;\r\n//     // console.log(pitch);\r\n//     freq_text.innerHTML = get_pitch(freq);\r\n//     line.setY(wglp_x, freq);\r\n//     wglp.update();\r\n//     wglp_x += 1;\r\n//     // console.log(buf);\r\n//     if (!window.requestAnimationFrame) window.requestAnimationFrame = window.webkitRequestAnimationFrame;\r\n//     rafID = window.requestAnimationFrame(update);\r\n// }\r\n\r\n}\r\nexport default new PD()","<template>\r\n  <v-container>\r\n     <v-row class=\"text-center\" justify=\"center\">\r\n      <v-col cols = \"6\">\r\n       <h2>音高识别</h2>\r\n       <v-btn small color = \"primary\" class = \"mt-2\" @click=\"recordAction\"> \r\n          <span v-if=\"isRecording\">结束录制</span>\r\n          <span v-else>开始录制</span>\r\n        </v-btn>\r\n      </v-col>\r\n      <v-col cols = \"6\" >\r\n        <!-- <v-avatar tile color =\"primary\" size = \"6em\" class = \"white--text\">\r\n          <div id=\"pitch_name\" style=\"fontSize:3em;position:absolute\">{{pitch_name}}</div>\r\n          <div id=\"degree_name\" style=\"fontSize:1em;position:absolute;marginLeft:4em;marginBottom:4em\">{{degree}}</div>\r\n          <div id=\"cents_name\" style=\"fontSize:1em;position:absolute;marginTop:4em\">{{cents}}</div>\r\n        </v-avatar> -->\r\n        <v-card class=\"mx-auto white--text\" max-width=\"6em\" max-height=\"6em\" color = \"primary\" >\r\n          <v-card-text class=\"white--text\" style=\"padding:0\">\r\n            <div id=\"pitch_name\"  class=\"display-1 \"> {{pitch_name}} </div>\r\n            <div id=\"degree_name\"> {{degree}}</div>\r\n            <div id=\"cents_name\" >\r\n                {{cents}}\r\n            </div>\r\n          </v-card-text>\r\n        </v-card>\r\n        \r\n        \r\n      </v-col>\r\n    </v-row>\r\n    \r\n    <v-layout row wrap class=\"mx-2 my-1\">\r\n      <v-flex xs12>\r\n        <h4 class =\"\">音量能量:{{db.toFixed(3)}} 采样长度:{{sampleLen}} </h4>\r\n      </v-flex>\r\n      <v-flex xs12>\r\n        <h5 class=\"mt-3\">如果发现音量能量总是为0或者过大，请调整麦克风音量: {{micGain}}</h5>\r\n         <v-slider min=\"0.0\" max=\"5.0\" label=\"mic音量\" v-model=\"micGain\" step=\"0.1\"></v-slider>\r\n      </v-flex>\r\n      <v-flex xs12>\r\n        <h4 class=\"mt-3\">实时音频</h4>\r\n        <v-divider></v-divider>\r\n      </v-flex>\r\n     \r\n      <v-flex xs12>\r\n        <canvas id=\"audio_canvas\" style=\"border: 1px solid black; width:100%; height:7em\"></canvas>\r\n      </v-flex>\r\n    </v-layout>\r\n    <v-layout row wrap class=\"mt-1 mx-2\">\r\n      <v-flex xs12>\r\n        <h4 class=\"mt-3\">音高曲线</h4>\r\n        <v-divider></v-divider>\r\n      </v-flex>\r\n      <v-flex xs12>\r\n        <canvas id=\"pitch_canvas\" style=\"border: 1px solid black; width:100%; height:28em\"></canvas>\r\n      </v-flex>\r\n    </v-layout>\r\n    <v-layout column wrap v-if=\"recordings.length > 0\">\r\n      <h4 class=\"mt-3\">已保存录音</h4>\r\n      <div v-for=\"(recording,idx) in recordings\" :key=\"recording.ts\">\r\n        <v-card>\r\n          <v-card-title primary-title>\r\n            <v-layout column wrap>\r\n              <div style=\"fontSize:0.8em\">\r\n                录音-{{ idx + 1 }}\r\n              </div>\r\n              <div class=\"ml-3\">\r\n                <div>\r\n                  <audio :src=\"recording.blobUrl\" :type=\"recording.mimeType\" controls=\"true\"/>\r\n                </div>\r\n                <div  style=\"fontSize:0.5em\">\r\n                   大小: {{recording.size}}, 类型: {{recording.mimeType}}\r\n                </div>\r\n              </div>\r\n            </v-layout>\r\n          </v-card-title>\r\n        </v-card>\r\n        <v-divider v-if=\"idx !== (recordings.length-1)\"/>\r\n      </div>\r\n    </v-layout>\r\n  </v-container>\r\n</template>\r\n\r\n<script>\r\n\r\nimport RecorderService from '../plugins/RecorderService'\r\nimport $ from \"jquery\"\r\nimport PD from \"../plugins/pitch_detect\"\r\n\r\n// import utils from '../plugins/Utils'\r\n\r\nconst SMOOTHING = 0.9\r\nconst FFT_SIZE = 4096\r\n\r\nexport default {\r\n  name: 'PitchDetect',\r\n  data: () => ({\r\n    echoCancel: false,\r\n    isRecording: false,\r\n    mimeTypes: [],\r\n    recordings: [],\r\n    micGain: 1,\r\n    cleanup: true,\r\n    fs:44100,\r\n    dynamicCompress: false,\r\n    pitch_name:'A',\r\n    cents:'0',\r\n    degree:'4',\r\n    maxFreq: 90,\r\n    pitchMaxX:200,\r\n    pitchSeq:[],\r\n    pitchColor:[],\r\n    curPos:0,\r\n    isCalc: true,\r\n    db:0,\r\n    ratio:1,\r\n    sampleLen:0\r\n  }),\r\n  methods: {\r\n    recordAction() {\r\n      if(this.isRecording) {\r\n        this.stopRecording()\r\n      }\r\n      else {\r\n        this.startRecording()\r\n      }\r\n    },\r\n    startRecording () {\r\n      this.recorder.config.stopTracksAndCloseCtxWhenFinished = this.cleanup\r\n      this.recorder.config.createDynamicsCompressorNode = this.dynamicCompress\r\n      this.recorder.config.enableEchoCancellation = this.echoCancel\r\n      this.recorder.config.micGain = this.micGain\r\n      // this.isCalc = true\r\n      this.recorder.startRecording()\r\n        .then(() => {\r\n          this.isRecording = true\r\n          this.analyser = this.recorder.analyserNode\r\n          this.audioCtx = this.recorder.audioCtx\r\n          this.fs = this.analyser.context.sampleRate\r\n          this.analyser.smoothingTimeConstant = SMOOTHING\r\n          this.analyser.fftSize = FFT_SIZE\r\n          this.analyser.minDecibels = -140\r\n          this.analyser.maxDecibels = 0\r\n          this.freqs = new Uint8Array(this.analyser.frequencyBinCount)\r\n          this.times = new Uint8Array(this.analyser.frequencyBinCount)\r\n          this.sampleLen = this.analyser.frequencyBinCount\r\n          this.ratio = 1\r\n          // console.log(this.ratio)\r\n\r\n          this.audio_canvas = $(\"#audio_canvas\").get(0)\r\n          let drawContext = this.audio_canvas.getContext('2d')\r\n          drawContext.scale(this.ratio, this.ratio)\r\n          // this.audio_canvas.width = this.audio_canvas.width\r\n          // this.audio_canvas.height = this.audio_canvas.height\r\n          this.audio_canvasWidth = this.audio_canvas.width / this.ratio\r\n          this.audio_canvasHeight = this.audio_canvas.height / this.ratio\r\n\r\n          this.pitch_canvas = $(\"#pitch_canvas\").get(0)\r\n          drawContext = this.pitch_canvas.getContext('2d')\r\n          drawContext.scale(this.ratio, this.ratio)\r\n          // this.pitch_canvas.width = this.pitch_canvas.width\r\n          // this.pitch_canvas.height = this.pitch_canvas.height\r\n          this.pitch_canvasWidth = this.pitch_canvas.width / this.ratio\r\n          this.pitch_canvasHeight = this.pitch_canvas.height / this.ratio\r\n\r\n          window.requestAnimationFrame(this.draw.bind(this))\r\n        })\r\n        .catch((error) => {\r\n          console.error('Recording Failed: ' + error)\r\n          alert('Recording Failed: ' + error.message)\r\n        })\r\n    },\r\n    stopRecording () {\r\n      this.recorder.stopRecording()\r\n      this.isRecording = false\r\n    },\r\n    onNewRecording (evt) {\r\n      this.recordings.push(evt.detail.recording)\r\n    },\r\n    draw() {\r\n      \r\n      \r\n      this.analyser.getByteFrequencyData(this.freqs)\r\n      this.analyser.getByteTimeDomainData(this.times)\r\n      let t_value = new Array()\r\n      let f_value = new Array()\r\n      for (let i = 0; i < this.analyser.frequencyBinCount;++i) {\r\n        t_value.push(this.times[i] / 256 - 0.5)\r\n        f_value.push(this.freqs[i] / 256 - 0.5)\r\n      }\r\n      let ans_fre = PD.get_frequency(t_value, this.fs, this.micGain)\r\n      // let ans_fre = PD.new_get_frequency(t_value, this.fs, this.micGain, this.pitchSeq)\r\n      let ans_pitch = PD.get_pitch(ans_fre[0])\r\n      // console.log(this.freqs)\r\n      // console.log(this.times)\r\n      // draw audio canvas\r\n      let canvas = this.audio_canvas\r\n      let drawContext = canvas.getContext('2d')\r\n      let cWidth = this.audio_canvasWidth\r\n      let cHeight = this.audio_canvasHeight\r\n      drawContext.clearRect(0, 0, cWidth, cHeight)\r\n     \r\n      // Draw the frequency domain chart.\r\n      for (let i = 0; i < this.analyser.frequencyBinCount; i++) {\r\n        let value = this.freqs[i] / 256 \r\n        let height = cHeight * value\r\n        let offset = cHeight - height - 1\r\n        let barWidth = cWidth / this.analyser.frequencyBinCount\r\n        let hue = i / this.analyser.frequencyBinCount * 360\r\n        drawContext.fillStyle = 'hsl(' + hue + ', 100%, 50%)'\r\n        drawContext.fillRect(i * barWidth, offset, barWidth, height)\r\n        // console.log(hue)\r\n      }\r\n      // Draw the time domain chart.\r\n      drawContext.fillStyle = 'gray'\r\n      for (let i = 0; i < this.analyser.frequencyBinCount; i++) {\r\n        let value = this.times[i] / 256 + (this.times[i] / 256 - 0.5) * (this.micGain-1)\r\n        let height = cHeight * value\r\n        let offset = cHeight - height - 1\r\n        let barWidth = cWidth / this.analyser.frequencyBinCount\r\n        drawContext.fillRect(i * barWidth, offset, 1, 2)\r\n      }\r\n\r\n      // draw pitch canvas\r\n      canvas = this.pitch_canvas\r\n      drawContext = canvas.getContext('2d')\r\n      cWidth = this.pitch_canvasWidth\r\n      cHeight = this.pitch_canvasHeight\r\n      drawContext.clearRect(0, 0, cWidth, cHeight)\r\n      // update the pitch sequence\r\n      for(let i = this.pitchSeq.length - 1;i > 0;--i) {\r\n        this.pitchSeq[i] = this.pitchSeq[i - 1]\r\n        this.pitchColor[i] = this.pitchColor[i - 1]\r\n      }\r\n      this.pitchSeq[0] = ans_fre[0]\r\n      this.db = ans_fre[1]\r\n      // console.log(ans_fre[1])\r\n      // if (ans_fre[1] > 0.03)this.pitchColor[0] = 'red'\r\n      // else this.pitchColor[0] = 'gray'\r\n      // Draw the pitch_contour.\r\n      \r\n      for (let i = 0; i < this.pitchMaxX - 1; i++) {\r\n        drawContext.fillStyle = 'rgba(255,0,0,1)'\r\n        let value =  (12 * (Math.log(this.pitchSeq[i] / 440) / Math.log(2)) + 40) / this.maxFreq\r\n        let diff = Math.abs(Math.log((this.pitchSeq[i] + 1.1)/ 440) / Math.log(2) - Math.log((this.pitchSeq[i + 1] + 1.1) / 440) / Math.log(2)) * 12\r\n        let height = cHeight * value\r\n        let offset = cHeight - height - 1\r\n        let barWidth = cWidth / this.pitchMaxX\r\n        \r\n        // drawContext.fillStyle = this.pitchColor[i]\r\n        if (diff > 1) {\r\n          // console.log(diff)\r\n          drawContext.fillStyle = 'rgba(255,0,0,0.2)'\r\n        }\r\n        else {\r\n          if (this.isCalc) {\r\n            this.pitch_name = ans_pitch[0]\r\n            this.degree = ans_pitch[1]\r\n            this.cents = Math.ceil(ans_pitch[2] / 50) * 50\r\n          }\r\n        }\r\n        drawContext.fillRect(i * barWidth, offset, barWidth, 1)\r\n        // console.log(hue)\r\n      }\r\n      // this.isCalc = !this.isCalc\r\n      // console.log(ans_fre)\r\n      // console.log(ans_pitch)\r\n      if (this.isRecording) {\r\n        window.requestAnimationFrame(this.draw.bind(this))\r\n      }\r\n\r\n    },\r\n  },\r\n  created() {\r\n    this.recorder = new RecorderService()\r\n    this.recorder.config.createAnalyserNode = true\r\n    this.recorder.em.addEventListener(\"recording\", (evt) => this.onNewRecording(evt))\r\n    this.curPos = 0\r\n    for (let i = 0; i < this.pitchMaxX;++i) {\r\n      this.pitchSeq[i] = 0.0\r\n      this.pitchColor[i] = 'rgba(255, 0, 0,1)'\r\n    }\r\n  }\r\n}\r\n</script>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PitchDetect.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PitchDetect.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./PitchDetect.vue?vue&type=template&id=3c3c0d12&\"\nimport script from \"./PitchDetect.vue?vue&type=script&lang=js&\"\nexport * from \"./PitchDetect.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VCardText } from 'vuetify/lib/components/VCard';\nimport { VCardTitle } from 'vuetify/lib/components/VCard';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VDivider } from 'vuetify/lib/components/VDivider';\nimport { VFlex } from 'vuetify/lib/components/VGrid';\nimport { VLayout } from 'vuetify/lib/components/VGrid';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSlider } from 'vuetify/lib/components/VSlider';\ninstallComponents(component, {VBtn,VCard,VCardText,VCardTitle,VCol,VContainer,VDivider,VFlex,VLayout,VRow,VSlider})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-container',[_c('v-row',{staticClass:\"text-center\",attrs:{\"justify\":\"center\"}},[_c('v-col',{attrs:{\"cols\":\"2\"}},[_c('v-img',{staticClass:\"my-3\",attrs:{\"src\":require('../assets/logo.svg'),\"contain\":\"\",\"height\":\"100%\"}})],1)],1),_c('v-row',{staticClass:\"text-center\"},[_c('v-col',[_c('h2',[_vm._v(\"欢迎来到音高识别\")]),_c('br'),_c('p',[_vm._v(\"跟随此程序\")]),_c('p',[_vm._v(\"可以帮助你在电脑/手机浏览器上完成歌唱音高识别\")]),_c('p',[_vm._v(\"你可以在第一个流程中测试你的麦克风\")]),_c('p',[_vm._v(\"麦克风测试成功后，在第二个流程中进行音高识别\")])])],1),_c('v-row',{staticClass:\"text-center\",attrs:{\"justify\":\"center\"}},[_c('div',{staticClass:\"my-2\"},[_c('v-btn',{attrs:{\"small\":\"\",\"color\":\"primary\"},on:{\"click\":_vm.testMic}},[_vm._v(\"测试麦克风\")])],1)]),_c('v-row',{staticClass:\"text-center\",attrs:{\"justify\":\"center\"}},[_c('div',{staticClass:\"my-2\"},[_c('v-btn',{attrs:{\"small\":\"\",\"color\":\"primary\"},on:{\"click\":_vm.startPitchDetect}},[_vm._v(\"音高识别\")])],1)])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <v-container>\n    <v-row class=\"text-center\" justify =\"center\">\n      <v-col cols=\"2\">\n        <v-img\n          :src=\"require('../assets/logo.svg')\"\n          class=\"my-3\"\n          contain\n          height=\"100%\"\n        />\n      </v-col>\n   </v-row>\n    <v-row class=\"text-center\">\n      <v-col>\n       <h2>欢迎来到音高识别</h2><br>\n       <p>跟随此程序</p>\n       <p>可以帮助你在电脑/手机浏览器上完成歌唱音高识别</p>\n       <p>你可以在第一个流程中测试你的麦克风</p>\n       <p>麦克风测试成功后，在第二个流程中进行音高识别</p>\n      </v-col>\n    </v-row>\n    <v-row class=\"text-center\" justify =\"center\">\n        <div class=\"my-2\">\n          <v-btn small color=\"primary\" @click=\"testMic\">测试麦克风</v-btn>\n        </div>\n    </v-row>\n    <v-row class=\"text-center\" justify =\"center\">\n        <div class=\"my-2\">\n          <v-btn small color=\"primary\" @click=\"startPitchDetect\">音高识别</v-btn>\n        </div>\n    </v-row>\n\n  </v-container>\n</template>\n\n<script>\n  export default {\n    name: 'Tutorial',\n    data: () => ({\n    }),\n    methods: {\n      testMic() {\n        this.$router.push('/mictest')\n      },\n      startPitchDetect() {\n        this.$router.push('/pitchdetect')\n      }\n    },\n    mounted() {\n      //\n    },\n    created() {\n    }\n  }\n</script>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Tutorial.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Tutorial.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Tutorial.vue?vue&type=template&id=0d84c56f&\"\nimport script from \"./Tutorial.vue?vue&type=script&lang=js&\"\nexport * from \"./Tutorial.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VImg } from 'vuetify/lib/components/VImg';\nimport { VRow } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VCol,VContainer,VImg,VRow})\n","import Vue from 'vue'\r\nimport VueRouter from 'vue-router'\r\nimport App from './App.vue'\r\nimport vuetify from './plugins/vuetify'\r\nimport MicTest from './components/MicTest'\r\nimport PitchDetect from './components/PitchDetect'\r\nimport Tutorial from './components/Tutorial'\r\n\r\nVue.config.productionTip = false\r\nVue.use(VueRouter)\r\nVue.prototype.showHome = true\r\n\r\nconst router = new VueRouter({\r\n  routes: [\r\n    {\r\n      path: '/',\r\n      name: 'tutorial',\r\n      component: Tutorial\r\n    },\r\n    {\r\n      path: '/mictest',\r\n      name: 'mictest',\r\n      component: MicTest\r\n    },\r\n    {\r\n      path: '/pitchdetect',\r\n      name: 'pitchdetect',\r\n      component: PitchDetect\r\n    }\r\n  ]\r\n})\r\n\r\nnew Vue({\r\n  vuetify,\r\n  router,\r\n  render: h => h(App)\r\n}).$mount('#app')\r\n","module.exports = __webpack_public_path__ + \"img/logo.c8c59542.svg\";"],"sourceRoot":""}